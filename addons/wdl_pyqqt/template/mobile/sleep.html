<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8">

  <!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->

  <meta name="HandheldFriendly" content="true">

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

  <!-- 微软的老式浏览器 -->

  <meta name="MobileOptimized" content="320">

  <!-- UC QQ强制竖屏 -->

  <meta name="screen-orientation" content="portrait">

  <meta name="x5-orientation" content="portrait">

  <link rel="stylesheet" type="text/css" href="{MODULE_URL}/template/public/css/normalize.min.css?t=1461156541">

  <link rel="stylesheet" type="text/css" href="{MODULE_URL}/template/public/css/style.css?t=1461156541">

	<script>
        var gSound ="{$config['mp3']}";
    </script>
    <div id="audiocontainer"></div>
    <script src="{MODULE_URL}/template/public/img/sound.js" type="text/javascript"></script>

  <title>{$config['index_page_title']}</title>

  {php echo register_jssdk(false);}

</head>

<body>

  <header class="headerWords"; style="background-image:url({$_W['attachurl']}{$config['qdymaa_img']});background-size:100% 100%;>

    <div id="assist"></div>

    <img src="{$user['avatar']}">

    <span id="userName">{$user['nickname']}<br></span>

    <div class="userWords">

      <span><br></span>

      <span>{$config['top_tip']}</span>

    </div>

  </header>



  <div id="money">

    <span class="icon iconfont">&#xe607;</span>

    <span>乞讨收入：<span>&yen {$user['income']}</span></span>

  </div>

  <div class="award">

    <span class="icon iconfont">&#xe604;</span>

    <span>继续努力新一任的帮主非你莫属</span>

  </div>

  {if $myorder['price'] > 0 || $_W['openid'] == $_GPC['openid']}

  <section id="list">

    <div class="words">

      <span class="icon iconfont">&#xe630;</span>

      <span>{$config['tip_2']}</span>

    </div>

    <div id="imgGroup">

      {loop $wantorders $v}

            <img src="{$v['user']['avatar']}" alt="{$v['user']['nickname']}, · ¥ {$v['income']}">      

      {/loop}

      </div>

  </section>

  {else}

  <section id="list">

    <div class="words">

      <span class="icon iconfont">&#xe630;</span>

      <span>{$config['tip_1']}</span>

    </div>

    <div id="imgGroup" class="fuzzy">

      <img src="{$my['avatar']}" alt="{$my['nickname']}, · ¥ 0">

      <img src="{MODULE_URL}/template/public/img/FsYGDw8BlCH47J8hpEhibb6o3nSK">

      <img src="{MODULE_URL}/template/public/img/FonWXSLinrpAXOgqsn1K6yIlzPrL">

      <img src="{MODULE_URL}/template/public/img/Fjm8dL1VefO2PoBk-lr51HjKH9bR">

      <img src="{MODULE_URL}/template/public/img/FoktpWXX5G4uXEfEmIbUSgJP1KNq">

      <img src="{MODULE_URL}/template/public/img/FnsYYd7Ee2V1zmycdWHd_Kz_veLZ">

      <img src="{MODULE_URL}/template/public/img/FkEiY6yrvXOSv20aoUn6PioVaWRl">

       

    </div>  

  </section>

  {/if}

  

  {if $_W['openid'] == $_GPC['openid']}

  <footer>

    <img src="{MODULE_URL}/template/public/img/Fp_5TWvfSLDtKSSlLD4aIl7QjmsG">

    <span>{$config['tip_3']}</span>

    <button onclick='window.location.href="{php echo $this->createMobileUrl('index'); }"'>{$config['tip_4']}</button>

  </footer>

  {elseif $myorder['price'] > 0}

  <footer>

    <img src="{MODULE_URL}/template/public/img/Fp_5TWvfSLDtKSSlLD4aIl7QjmsG">

    <span>{$config['tip_5']}</span>

    <button onclick='window.location.href="{php echo $this->createMobileUrl('index'); }"'>{$config['tip_6']}</button>

  </footer>

  {else}

  <div class="remindFuzzy">

    <span>{$config['tip_7']}</span>   

  </div>

  <footer>

    <img src="{MODULE_URL}/template/public/img/Fp_5TWvfSLDtKSSlLD4aIl7QjmsG">

    <span>{$config['tip_8']}</span>

    <button class="sleep_him">{$config['tip_9']}</button>

  </footer>

  {/if}

  <div id="bodyAssist"></div>

  <div id="packet">

    <img id="refresh" src="{MODULE_URL}/template/public/img/refresh.png">

    <div id="packetMoney">

      <ul id="scroll1"></ul>

      <span class="point">.</span>

      <ul id="scroll2"></ul>

      <span class="unit"> 元</span>

    </div>

    <span id="packetWords">一块就成，当牛做马都行！</span>

    <button id="pay-btn">{$config['tip_9']}</button>

  </div>

  <div id="remind">

    <span>{$config['tip_10']}</span>   

  </div>

  <button id="createPage">{$config['tip_11']}</button>



  <script>

  var _redpack_list = [{"fee":"0.01","desc":"\u8ba9\u0054\u0061\u6eda\u86cb"},{"fee":"0.10","desc":"\u97ad\u631e\u0054\u0041"},{"fee":"0.50","desc":"\u7528\u811a\u8e39\u0054\u0041"},{"fee":"1.00","desc":"\u8e22\u0054\u0061\u7684\u88e4\u88c6"},{"fee":"1.21","desc":"\u8ba9\u0054\u0061\u88f8\u5954"},{"fee":"1.74","desc":"\u7528\u7ef3\u5b50\u628a\u0054\u0061\u6346\u8d77\u6765"},{"fee":"1.23","desc":"\u8ba9\u5c0f\u5f3a\u548c\u0054\u0041\u4e00\u8d77\u73a9\u800d"},{"fee":"2.13","desc":"\u8ba9\u0054\u0061\u6361\u80a5\u7682"},{"fee":"2.22","desc":"\u8ba9\u0054\u0061\u53bb\u62cd\u7247"},{"fee":"2.33","desc":"\u7528\u773c\u795e\u5c04\u6740\u0054\u0061"},{"fee":"0.01","desc":"\u8ba9\u0054\u0061\u6eda\u86cb"},{"fee":"0.10","desc":"\u97ad\u631e\u0054\u0041"},{"fee":"0.50","desc":"\u7528\u811a\u8e39\u0054\u0041"},{"fee":"1.00","desc":"\u8e22\u0054\u0061\u7684\u88e4\u88c6"},{"fee":"1.21","desc":"\u8ba9\u0054\u0061\u88f8\u5954"},{"fee":"1.74","desc":"\u7528\u7ef3\u5b50\u628a\u0054\u0061\u6346\u8d77\u6765"},{"fee":"1.23","desc":"\u8ba9\u5c0f\u5f3a\u548c\u0054\u0041\u4e00\u8d77\u73a9\u800d"},{"fee":"2.13","desc":"\u8ba9\u0054\u0061\u6361\u80a5\u7682"},{"fee":"2.22","desc":"\u8ba9\u0054\u0061\u53bb\u62cd\u7247"},{"fee":"2.33","desc":"\u7528\u773c\u795e\u5c04\u6740\u0054\u0061"},{"fee":"4.19","desc":"\u6536\u0054\u0061\u4e3a\u5bb6\u5974"},{"fee":"5.20","desc":"\u60f3\u548c\u0054\u0061\u7761\u4e00\u89c9"},{"fee":"5.55","desc":"\u6709\u6211\u5728\u522b\u6015"},{"fee":"6.00","desc":"6\u5757\u94b1\uff0c\u8ba9\u0054\u0061\u53bb\u9686\u80f8\u3002"},{"fee":"6.66","desc":"\u5e74\u8f7b\u4eba\uff0c\u4f60\u7684\u601d\u60f3\u5f88\u5371\u9669\u5416"},{"fee":"6.90","desc":" \u5d07\u62dc\u0054\u0061\u60f3\u548c\u0054\u0061\u4e00\u8d77\u6df7"},{"fee":"8.88","desc":"\u4e00\u8d77\u4e48\u4e48\u54d2\u4e0d\u5982\u4e00\u8d77\u556a\u556a\u556a"},{"fee":"9.42","desc":"\u8fd9\u5c31\u662f\u771f\u7231"},{"fee":"9.99","desc":"\u966a\u0054\u0061\u5230\u5929\u957f\u5730\u4e45"},{"fee":"13.14","desc":"\u5c71\u76df\u6d77\u8a93\uff0c\u4e0d\u5982\u5e8a\u4e0a\u4e00\u8bd5\u3002"},{"fee":"18.00","desc":"\u4eca\u5929\u5c31\u5305\u517b\u0054\u0061"},{"fee":"19.99","desc":"\u4e00\u89c9\u4e0d\u591f\uff0c\u8981\u4e45\u4e45\u4e45\u3002"}];

  var _redpack_money = 0;

  </script>

  <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

  <script src="{MODULE_URL}/template/public/js/zepto.1.1.6.min.js"></script>

  <script src="{MODULE_URL}/template/public/js/zepto.touch.js"></script>

  <script src="{MODULE_URL}/template/public/js/global.js?t=1461156541"></script>

  <script type="text/javascript">

    $('#createPage').tap(function() {

      window.location.href="{php echo $this->createMobileUrl('index'); }";

    });

    _redpack_money  = generate_money(_redpack_list);

    for (var i = 0; i < 9; i++) {

      var li_high = Math.floor(Math.random()*10).toString();

      var li_low = Math.floor(Math.random()*10).toString() + Math.floor(Math.random()*10).toString();

      $('#scroll1').append('<li>' + li_high + '</li>');

      $('#scroll2').append('<li>' + li_low + '</li>');

    }    

    var li = document.querySelectorAll("li");

    var liHeight = li[0].offsetHeight;



    function generate_money(money_list){

      var random = Math.floor(Math.random()*money_list.length);

      var money = money_list[random].fee;

      var description = money_list[random].desc;

      var money_high = money.split('.')[0];

      var money_low = money.split('.')[1];

      $('#scroll1').append('<li>'+money_high+'</li>');

      $('#scroll2').append('<li>'+money_low+'</li>');

      $('#packetWords').text(description);

      return money;

    }

    var scroll_flag = true;

    var scroll_speed = 0.5,flag = 0,stop_flag = false;



    $('#refresh').on('tap',function(e){

      if(scroll_flag == true){

        scroll_start();

        scroll_remove();

      }

    });



    function scrolling(){

      if(stop_flag == true)return ;

      flag++;

      document.getElementById('scroll1').scrollTop++;

      document.getElementById('scroll2').scrollTop++;

      if(flag>document.getElementById('scroll1').scrollTop){

        flag = 0;

        document.getElementById('scroll1').scrollTop = 0;

        document.getElementById('scroll2').scrollTop = 0;

      }

      $('#refresh').css({

        'animation':'refreshMove 1s linear infinite',

        '-webkit-animation':'refreshMove 1s linear infinite',

        '-moz-animation':'refreshMove 1s linear infinite'

      });

    }

    function scroll_stop(){

      $('#refresh').css({

        'animation':'',

        '-webkit-animation':'',

        '-moz-animation':''

      });

      stop_flag = true;

      scroll_flag = true;

      _redpack_money  = generate_money(_redpack_list);

      document.getElementById('scroll1').scrollTop = liHeight*10;

      document.getElementById('scroll2').scrollTop = liHeight*10;   

    }

    function scroll_remove(){

      $('#scroll1 :nth-child(2)').remove();

      $('#scroll2 :nth-child(2)').remove();

    }

    function scroll_start(){

      scroll_flag = false;

      setInterval('scrolling()',scroll_speed);

      setTimeout('scroll_stop()',800);

      stop_flag = false;

    }

  </script>

  <script>

    var _pay = {

      timestamp: 0, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符

      nonceStr: '', // 支付签名随机串，不长于 32 位

      package: '', // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=***）

      signType: '', // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'

      paySign: '', // 支付签名

      success: function (res) {

        // 支付成功后的回调函数

        // alert('支付成功');

        //window.location.href = "http://m.yyapp.in/scheme/moments/redpack/timeline/23423";

      }

    }

    wx.ready(function () {

    sharedata = {

      title: "{$config['share_title']}",

      desc: "{$config['share_desc']}",

      link: "{$config['link']}",

      imgUrl: "{$config['share_cover']}",

      success: function(){

        var share_ok_url = "{$config['share_ok_url']}";

        if (share_ok_url) {

          window.location.href = share_ok_url;

        }

      },

      cancel: function(){

        //alert('cancel');

      }

    };

    wx.onMenuShareAppMessage(sharedata);

    wx.onMenuShareTimeline(sharedata);

  });



    Zepto(function($) {

      $('#pay-btn').tap(function() {

        var price = parseFloat((_redpack_money * 1).toFixed(2));

        var orderid = new Date().getTime();     // 订单号

        var params = new Array();

        params['price'] = price;

        params['orderid'] = orderid;

        params['origin'] = "{$_GPC['openid']}";

        params['want'] = "{$_W['openid']}";

        pay(price,orderid,params,payok,paycancel,payfail);

        // $.ajax({

        //   type: 'post',

        //   url: "{php echo $this->createMobileUrl('pay'); }",

        //   data: { 

        //     fee: parseInt((_redpack_money * 100).toFixed()),

        //     timeline_id: 23423

        //   },

        //   dataType: 'json',

        //   timeout: 20000,

        //   beforeSend: function(xhr, settings) {



        //   }, 

        //   success: function(data) {

        //     if (data.errcode == 0) {

        //       alert(data.jsapi);

        //       alert(data.price);

        //       var payconf = JSON.parse(data.jsapi);

        //       alert(payconf.paySign);

        //       _pay['timestamp'] = payconf.timeStamp;

        //       _pay['nonceStr'] = payconf.nonceStr;

        //       _pay['package'] = payconf.package;

        //       _pay['signType'] = payconf.signType;

        //       _pay['paySign'] = payconf.paySign;

        //       wx.chooseWXPay(_pay);

        //     } else {



        //     }

        //   },

        //   error: function(xhr, type){

        //     alert('网络异常,请您重新提交');

        //   }

        // });

      });

    });



        function payok(params){

            $.ajax({

                url : "{php echo $this->createMobileUrl('deal_pay'); }",

                type : "post",

                dataType : "json",

                data : {

                    price : params['price'],

                    orderid : params['orderid'],

                    origin : params['origin'],

                    want : params['want']

                },

                success : function(data) {

                    if (data.errcode == 1111) {

                        window.location.href = data.url;

                    } else {

                        alert(data.errmsg);

                    }

                }

            });

        }



        function paycancel(params){

            alert("支付取消")

        }



        function payfail(params){

            alert("支付失败");

        }



        /**

         * ajax提交数据函数

         * @param String url 处理数据的地址

         * @param Array data 提交的数据

         * @param String successMsg 提交数据成功的提示信息

         * @param String errorMsg 提交数据失败的提示信息

         */

        function ajax(url,data,successFunc,errorFunc){

          $.ajax({

            url:url,

            type:"post",

            dataType:"json",

            data:data,

            success:function(data){

              successFunc(data);

            },

            error:function(){

              errorFunc(data);

            }

          });

        }





        /**

         * 微信支付

         */

        function pay(price,orderid,params,payokFunc,paycancelFunc,payfailFunc){

          var url = "{php echo $this->createMobileUrl('json_pay'); }";

          var price = price;

          if (!price) {

            price = 0.01;

          }

          // alert(url+"--"+"price="+price+"&orderid="+orderid);

          $.ajax({

            url : url,

            type : "post",

            dataType : "json",

            data : "price="+price+"&orderid="+orderid,

            success : function(data){

              var json_str = data;

              var json_obj = JSON.parse(json_str);

              callpay(json_obj,params,payokFunc,paycancelFunc,payfailFunc);

            },

            error : function(){

              alert("error");

            }

          });

        }



        function callpay(json_obj,params,payokFunc,paycancelFunc,payfailFunc){

          wx.chooseWXPay({

              timestamp: json_obj.timeStamp, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符

              nonceStr: json_obj.nonceStr, // 支付签名随机串，不长于 32 位

              package: json_obj.package, // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=***）

              signType: json_obj.signType, // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'

              paySign: json_obj.paySign, // 支付签名

              success: function (res) {

                  payokFunc(params);

              }

          });

        }

  </script> 

    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258680054'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "w.cnzz.com/q_stat.php%3Fid%3D1258680054' type='text/javascript'%3E%3C/script%3E"));</script>

  </body>

</html>