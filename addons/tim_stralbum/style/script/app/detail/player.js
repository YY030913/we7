define("script/app/detail/player",["script/tools/tools.js"],function(a,b,c){function d(a,b,c){n.actionUrl=a,k.requestData(a,function(a){a.page.items.length>0?k.requestData(server_path+a.page.items[0].actionUrl,function(a){try{e(a.content.pictureList,b,c)}catch(d){showError(error)}},function(a,b){showError(b)}):showError("数据请求失败")},function(a,b){showError(b)})}function e(a,b,c){var d=j("#player_box")[0];for(n.imageArray=[],i=0;i<a.length;i++){var e=image_path+a[i].imgPath,h=document.createElement("div");h.className="full relative",h.innerHTML='<div class="full play_inner" style="background-image:url('+q+')" ></div><div class="full play_cover" ></div>',d.appendChild(h),n.imageArray.push(e),h.addEventListener(l.getEvent(),function(){l.tmb_touch("",function(){g()})},!1)}setTimeout(function(){n.flipObj=new m.tmbFlip("player_box","H",null,!1,null,function(){},1,1,n.imageArray,q,q,"contain");for(var a=0;b+1>a;a++)n.flipObj.moveToPoint(a,0);c&&f()},10),l.showMenuEntrance()}function f(){n.playFlag=!0;var a=Math.round(2*Math.random()),b=j(".player_outer")[0],c=j(".player_outer")[1],d=j("#player_box")[0];0==a?(c.className+=" player_noscale",b.className+=" player_scale",setTimeout(function(){b.style[p]="200ms",b.style[o]="translate(0px, 0px) translateZ(0px) scale(1.5)",b.style.backgroundImage=n.flipObj.nodes[n.flipObj.currentPoint].children[0].style.backgroundImage,b.addEventListener("webkitTransitionEnd",function(){this.removeEventListener("webkitTransitionEnd",arguments.callee,!1),h()},!1)},0),d.style.opacity=0):1==a?n.flipObj.toRepeat(1,3e3):(b.id="player_outer",b.style.display="block",b.innerHTML=d.innerHTML,n.flipObj1=new m.tmbFlip("player_outer","S",function(){},!1,function(){n.flipObj.moveToPoint(n.flipObj1.currentPoint,0)},function(){},1,1,n.imageArray,q,q,"contain"),n.flipObj1.toRepeat(1,3e3),setTimeout(function(){for(var a=0;a<n.flipObj.currentPoint+1;a++)n.flipObj1.moveToPoint(a,0);n.flipObj1.toRepeat(1,3e3)},0),d.style.opacity=0),b.addEventListener(l.getEvent(),g,!1),c.addEventListener(l.getEvent(),g,!1)}function g(){n.playFlag=!1,j(".player_outer")[0].style.display="none",j(".player_outer")[0].outerHTML="<div class='player_outer'></div>",j(".player_outer")[1].style.display="none",j(".player_outer")[1].outerHTML="<div class='player_outer'></div>",j("#player_box")[0].style.opacity=1,null!=n.flipObj&&n.flipObj.cancelRepeat(),null!=n.flipObj1&&n.flipObj1.cancelRepeat()}function h(){var a=j(".player_scale")[0],b=j(".player_noscale")[0];a.style.opacity=1,b.style[p]="0s",b.style.opacity=1,setTimeout(function(){a.style[p]="3s",a.style[o]="translate(0px, 0px) translateZ(0px) scale(1)",a.addEventListener("webkitTransitionEnd",function(){a.style[p]="2s",b.style[o]="translate(0px, 0px) translateZ(0px) scale(1.5)",a.style.opacity=0,n.flipObj.hasNext()?n.flipObj.moveToPoint(n.flipObj.currentPoint+1,0):n.flipObj.moveToPoint(0,0),this.removeEventListener("webkitTransitionEnd",arguments.callee,!1),b.style.backgroundImage="url("+n.flipObj.imageArray[n.flipObj.currentPoint]+")",a.addEventListener("webkitTransitionEnd",function(){var c=a.className;a.className=b.className,b.className=c,a.style.backgroundImage=n.flipObj.currentPoint+1==n.flipObj.imageArray.length?"url("+n.flipObj.imageArray[0]+")":"url("+n.flipObj.imageArray[n.flipObj.currentPoint+1]+")",this.removeEventListener("webkitTransitionEnd",arguments.callee,!1),h()},!1)},!1)},1)}var j=a("script/tools/sizzle.js"),k=a("script/tools/ajax.js"),l=a("script/app/common/common.js"),m=a("script/tools/tmb_flip.js"),n={actionUrl:"",flipObj:null,flipObj1:null,imageArray:[],playFlag:!1},o=l.prefixStyle("transform"),p=l.prefixStyle("transitionDuration"),q="";c.exports={init:function(a,b,c,g){if(c||(c=0),j(".bheader")[0]&&(j(".bheader")[0].style.display="none"),l.hideSublingPage(j("#page_player")[0]),j("#player_box")[0]){for(var h=0;c+1>h;h++)n.flipObj.moveToPoint(h,0);g&&f()}else{n.actionUrl=a;var i=document.createDocumentFragment(),k=document.createElement("div");k.id="player_box";var m=document.createElement("div");m.className="player_outer";var o=m.cloneNode(!0);i.appendChild(k),i.appendChild(m),i.appendChild(o),j("#page_player")[0].appendChild(i),l.initCssFile(["addons/tim_stralbum/style/script/list.css"],function(){"undefined"!=typeof b?e(b,c,g):d(a,c,g)})}},play:function(){f()},stopPlay:function(){g()},appVar:n}});